<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>galgame第一次汉化记录</title>
      <link href="/2025/01/31/galgame%E6%B1%89%E5%8C%96/%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%B1%89%E5%8C%96%E8%AE%B0%E5%BD%95/"/>
      <url>/2025/01/31/galgame%E6%B1%89%E5%8C%96/%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%B1%89%E5%8C%96%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="游戏概述">游戏概述</h2><ul><li>游戏名称：しょうよん！ ～コドモ★ちゃれんじ～（柚子社早期作品）</li><li>原始语言：日文</li><li>目标语言：中文</li></ul><h2 id="汉化工具">汉化工具</h2><ul><li>使用的翻译：deepseeek-v3</li><li>使用的编辑器：vscode、IDA</li><li>其他辅助工具：winhex、吾爱破解(LCG)、GARbro、EXtractDATA</li></ul><h2 id="汉化过程">汉化过程</h2><h3 id="一分析游戏exe文件">一、分析游戏exe文件</h3><h4 id="更改游戏编码">① 更改游戏编码</h4><p>一般日本galgame的游戏编码都是shift-jis、近些年来少部分galgame的游戏编码是utf-8可以支持中文。所以想要完成游戏汉化，首先得把游戏里面的编码更改为支持中文的<strong>gbk</strong>编码</p><p>关于编码的一些经验之谈可以参考b站大佬的视频：[<ahref="https://www.bilibili.com/video/BV1fy4y157im/?spm_id_from=333.1387.upload.video_card.click">Gal汉化入门]#3.1编码&amp;范围校验修改演示_哔哩哔哩_bilibili</a></p><p>对于しょうよん！～コドモ★ちゃれんじ～这个游戏的游戏编码更改具体步骤如下：</p><p>1、通过利用<strong>吾爱破解(LCG)</strong>分析了游戏exe文件、在<strong>CreateFontA</strong>的输入函数下切换断点。</p><p>2、会发现编码的控制非常简单，只需将对应部分的0x80（shift-jis）-&gt;0x86（gbk）即可</p><figure><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202501311749187.png"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p>3、更改完会发现游戏出现乱码，是因为原来的文本内容是shift-jis</p><p>可以通过这个断点将所有涉及到日文编码的部分全部更改为gbk编码，也就是将0x80更改为0x86既可，</p><figure><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202501311753114.png"alt="image-20250131175335926" /><figcaption aria-hidden="true">image-20250131175335926</figcaption></figure><h4 id="提取游戏脚本文件">② 提取游戏脚本文件</h4><p><strong>方法一：通过已有工具去提取脚本文本</strong></p><p>通过<strong>GARbro</strong>初步分析游戏里面的文件，发现arc.nsa相关的文件都是关于游戏里面的音频以及对应的图片和cg部分。一般的脚本文件的大小都不会太大，通过分析发现游戏的脚本文件为根目录的<strong>nscript.dat</strong>文件。这个文件利用<strong>ExtractData</strong>既可提取里面的内容，并且利用<strong>vscode</strong>进行打开</p><figure><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202501311828186.png"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p><strong>方法二：利用IDA进行逆向exe文件，分析里面的加密逻辑进行提取</strong></p><p>通过IDA进行逆向对应的exe文件，通过分析发现nscript.dat的读取解密逻辑在sub_40B390里面。发现里面对于nscript.dat文件的解密只是简单的与0x84进行异或既可</p><figure><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202501311833567.png"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p>所以根据以上的分析可以很简单的得到对应的解密代码，下面是简单的用python进行实现的解密代码逻辑。</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;nscript.dat&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    encrypted_data = f.read()</span><br><span class="line">decrypted_data = <span class="built_in">bytes</span>([b ^ <span class="number">0x84</span> <span class="keyword">for</span> b <span class="keyword">in</span> encrypted_data])</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;nscript_decrypted.txt&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(decrypted_data)</span><br></pre></td></tr></table></figure><p>解密之后可以既可以得到里面的明文数据。</p><h4 id="文本汉化和应用">③ 文本汉化和应用</h4><p>通过搜索游戏里面开始出现的游戏文本<code>歩くだけで汗が流れ出る炎天下の中</code>，可以发现<strong>大概游戏文本出现在2508行</strong>的部分，前面也有相关控制游戏标题以及各种部分的日文，</p><p>其实也可以利用最简单的提取思路，<strong>只需要提取里面非英文以及英文标点符号之外的所有文本</strong>既可</p><p>利用re正则表达式</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">extract_jp_text</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="comment"># 正则表达式匹配非英文字符和标点</span></span><br><span class="line">    pattern = <span class="string">r&#x27;[^\u0020-\u007E]+&#x27;</span></span><br><span class="line">    <span class="comment"># 提取匹配的文本</span></span><br><span class="line">    jp_text = re.findall(pattern, text)</span><br><span class="line">    <span class="comment"># 无匹配文本则返回为None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> jp_text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    jp_text = <span class="string">&quot;&quot;</span>.join(jp_text)</span><br><span class="line">    <span class="comment"># 过滤空白行</span></span><br><span class="line">    jp_text = jp_text.strip()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> jp_text</span><br></pre></td></tr></table></figure><p>可以利用AI大模型的接口去进行汉化，我这边推荐用<ahref="https://www.deepseek.com/">DeepSeek | 深度求索</a></p><p>对于如何应用进游戏有两个策略。</p><p>1、免封包策略</p><ul><li>优点：简单、可以不依赖逆向完成简单的应用</li><li>缺点：有时候会导致有大量的敏感明文翻译内容，很多平台无法上传自己的补丁</li></ul><p>2、加密封包策略</p><ul><li>优点：可以防止自己翻译的敏感明文内容被暴露</li><li>缺点：需要利用IDA等工具去进行分析exe里面的加密封包逻辑</li></ul><p><strong>方案一、免封包策略</strong></p><p>通过前面提取游戏脚本文件的分析我们可以很容易发现，文件一开始是读取了多个文件的操作，里面包括就有0.txt以及00.txt，如果没有读取到就解包nscript.dat</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( !_access(<span class="string">&quot;0.txt&quot;</span>, <span class="number">0</span>) || !_access(<span class="string">&quot;00.txt&quot;</span>, <span class="number">0</span>) || _access(<span class="string">&quot;nscript.zat&quot;</span>, <span class="number">0</span>) )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( _access(<span class="string">&quot;0.txt&quot;</span>, <span class="number">0</span>) &amp;&amp; _access(<span class="string">&quot;00.txt&quot;</span>, <span class="number">0</span>) &amp;&amp; !_access(<span class="string">&quot;nscript.dat&quot;</span>, <span class="number">0</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v9 = _open(<span class="string">&quot;nscript.dat&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    v10 = v9;</span><br><span class="line">    <span class="keyword">if</span> ( v9 == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v11 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v12 = _filelength(v9);</span><br><span class="line">      _close(v10);</span><br><span class="line">      v11 = v12;</span><br><span class="line">    &#125;</span><br><span class="line">    v5 = (<span class="type">const</span> <span class="type">char</span> *)<span class="built_in">malloc</span>(v11 + <span class="number">5</span>);</span><br><span class="line">    dword_<span class="number">5E0288</span> = (<span class="type">int</span>)v5;</span><br><span class="line">    *v5 = <span class="number">0</span>;</span><br><span class="line">    v13 = <span class="built_in">fopen</span>(<span class="string">&quot;nscript.dat&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    v7 = v13;</span><br><span class="line">    <span class="keyword">if</span> ( !v13 )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_45;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="built_in">fgetc</span>(v13); i != <span class="number">-1</span>; i = <span class="built_in">fgetc</span>(v7) )</span><br><span class="line">      v5[v0++] = i ^ <span class="number">0x84</span>; <span class="comment">// 解密部分</span></span><br><span class="line">    <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>所以我们可以直接把利用<strong>ExtractData</strong>提取到的文本<strong>更改为00.txt或者0.txt</strong>放进游戏根目录然后将编码更改为前面我们已经修改为的GBK编码，再通过修改里面的剧情文本内容。最后发现游戏可以正常进入，并且测试正常</p><figure><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202501311921394.png"alt="image-20250131192140929" /><figcaption aria-hidden="true">image-20250131192140929</figcaption></figure><p><strong>方案二、加密封包策略</strong></p><p>通过前面利用IDA的分析，我们发现游戏的加密逻辑十分简单，故可以利用对应的python代码进行反向封包成dat文件，具体代码如下</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;128.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    text_data = f.read()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 将文本转换为字节并加密</span></span><br><span class="line">binary_data = text_data.encode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">encrypted_data = <span class="built_in">bytes</span>([b ^ <span class="number">0x84</span> <span class="keyword">for</span> b <span class="keyword">in</span> binary_data])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入dat文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;nscript1.dat&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(encrypted_data)</span><br></pre></td></tr></table></figure><p>将最后得到的dat文件放入游戏里面发现测试正常</p><figure><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202501311925591.png"alt="image-20250131192509318" /><figcaption aria-hidden="true">image-20250131192509318</figcaption></figure><h2 id="汉化总结">汉化总结</h2><p>经过不断的摸索，我的首个汉化补丁终于在2DFan上线啦！（<ahref="https://2dfan.com/downloads/32922">补丁下载地址</a>）作为汉化新手，这次从翻译到技术调试全程自学的经历，让我真正体会到汉化工作的不易——每一个流畅运行的补丁背后，都是无数细节的打磨和付出的努力。</p><p><strong>关于这次汉化：</strong>虽然是第一次尝试，但过程中积累了许多实用经验：比如游戏文本的提取以及相关工具的使用。特别推荐B站UP主<strong>Dir-A</strong>的教程（<ahref="https://space.bilibili.com/8144708">主页链接</a>），他的GitHub技术文档（<ahref="https://github.com/Dir-A/Dir-A_Essays_MD">Dir-A_Essays_MD</a>）给了我超多帮助！</p>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
          <category> 汉化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> galgame汉化 </tag>
            
            <tag> 逆向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROS双线巡线方案</title>
      <link href="/2024/07/31/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/ROS%E5%8F%8C%E7%BA%BF%E5%B7%A1%E7%BA%BF%E6%96%B9%E6%A1%88/"/>
      <url>/2024/07/31/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/ROS%E5%8F%8C%E7%BA%BF%E5%B7%A1%E7%BA%BF%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h1 id="ros双线巡线方案----第十九届科大讯飞智能车比赛">🚗ROS双线巡线方案 -- 第十九届科大讯飞智能车比赛</h1><p>这个ROS包是由<strong>长江大学极客班</strong>的极客👨‍💻👩‍💻开源，是第19届科大讯飞智能车救援组巡线比赛定制的方案，也可以用于其他双线内巡线的参考的ROS包方案。</p><p><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/demo.gif" /></p><h2 id="一起开源推动科技进步">🌟 一起开源，推动科技进步</h2><p>在这个快速变化的时代，开源是推动技术进步和创新的关键力量。通过分享我们的知识和代码，我们不仅可以加速技术的发展，还能培养新一代的工程师和开发者。我们鼓励大家加入开源社区，分享你的创意和成果，让更多人受益。</p><p>无论你是一个初学者还是经验丰富的专家，都可以在开源项目中找到你的位置。每一行代码、每一个建议都能为项目注入新的活力。让我们携手合作，共同推动科技的进步，创造一个更加开放和互联的世界。</p><p><strong>开源地址</strong>：</p><ul><li>Gitee：<ahref="https://gitee.com/changjiang-university_2/Line_Follower">Gitee</a></li><li>Github：<ahref="https://github.com/Crosery/ROS_Line_Follower">Github</a></li></ul><h2 id="闪亮特性">🌟 闪亮特性</h2><ul><li>🧠 智能图像处理：就像给你的小车装了一双火眼金睛</li><li>🎛️ 灵活PID控制：平滑巡线，宛如小车在跳华尔兹</li><li>🔧 超强可配置性：可以自由的调教你的小车</li></ul><h2 id="你需要准备的工具箱">🛠️ 你需要准备的工具箱</h2><p>在开始之前，请确保你的系统已经安装了以下环境和依赖：</p><ul><li>ROS（我们在Noetic上反复蹂躏测试过）</li><li>OpenCV（没有它，你的小车就像失明了一样）</li><li>其他一些厉害的库：cv_bridge、image_transport、sensor_msgs、geometry_msgs</li><li>Markdown环境（用于查看和编辑本README文件）</li></ul><blockquote><p>💡 提示：如果你还没有安装Markdown环境，可以使用VSCode或Typora等编辑器，它们对Markdown有很好的支持。</p></blockquote><h2 id="包的内部构造">📁 包的内部构造</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">line_follower/</span><br><span class="line">├── src/</span><br><span class="line">│   └── line_follower_node.cpp  (核心代码，小车的大脑！)</span><br><span class="line">├── config/</span><br><span class="line">│   ├── image.cfg  (调教你的火眼金睛)</span><br><span class="line">│   └── pid.cfg   (调教你的平衡感)</span><br><span class="line">├── launch/</span><br><span class="line">│   └── line_follower.launch  (一键启动，像魔法一样简单)</span><br><span class="line">├── rviz/</span><br><span class="line">│   └── img_follow_rviz_config.rviz  (RViz配置文件，可视化小车的路径跟踪)</span><br><span class="line">├── include/</span><br><span class="line">│   └── line_follower/  (头文件，用于代码的模块化和重用)</span><br><span class="line">├── CMakeLists.txt  (CMake配置文件，定义了如何构建项目)</span><br><span class="line">└── package.xml  (包配置文件，定义了包的元数据，如依赖关系、版本等)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="如何调教你的小车">⚙️ 如何调教你的小车</h2><ol type="1"><li><p>找个安静的地方，克隆这个包：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~/catkin_ws/src</span><br><span class="line">git clone https://gitee.com/changjiang-university_2/Line_Follower.git</span><br></pre></td></tr></table></figure></li><li><p>给它点营养，编译一下：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~/catkin_ws</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></li><li><p>在Ubuntu中安装C++ OpenCV依赖：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install libopencv-dev</span><br></pre></td></tr></table></figure></li><li><p>告诉它该干活了：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source ~/catkin_ws/devel/setup.bash</span><br></pre></td></tr></table></figure></li><li><p>打开小车的眼睛</p><p>需要启动你小车的摄像头，并且订阅对应的话题，在<code>config/pid.cfg</code>里面修改对应的话题名称</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">image_topic=/new_camera/image # 更改图像话题名称以匹配新设备</span><br></pre></td></tr></table></figure></li><li><p>启动动力能源</p><p>需要启动你小车的底盘，让小车能够进行运动，比如科大讯飞的ucar-mini一代车启动实例如下</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">roslaunch ucar_controller base_driver.launch</span><br></pre></td></tr></table></figure></li><li><p>唤醒你的小车：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">roslaunch line_follower line_follower.launch</span><br></pre></td></tr></table></figure></li></ol><h2 id="核心代码解密">🧠 核心代码解密</h2><p>我们的核心代码藏在 <code>src/line_follower_node.cpp</code>里面。来看看它有什么秘密：</p><ol type="1"><li><code>ImageProcessor</code> 类：这是小车的眼睛🧐</li></ol><ul><li>它能在杂乱的画面中精准找到那条线，就像在人海中一眼认出自己的对象✨</li></ul><ol start="2" type="1"><li><code>LineFollower</code> 类：这是小车的大脑和肌肉💪</li></ol><ul><li>它决定小车该怎么走，左转还是右转，快跑还是慢走🚗</li></ul><ol start="3" type="1"><li><p>参数读取：我们让小车变得很听话，你说什么它就怎么做👂</p></li><li><p>PID控制：这就像是给小车装了一个平衡器，让它走起路来虎虎生风🏋️‍♂️</p></li><li><p>调试输出：让你随时了解小车在想什么，做什么💡</p></li><li><p>图像话题：订阅<code>/img_follow</code>，就像打开小车眼睛的滤镜，一窥<code>ImageProcessor</code>如何把混乱变清晰，小车视角的独家揭秘，就在这里！👀</p></li></ol><h3 id="pid调参详解">🎛️ PID调参详解</h3><p>PID控制是这个包的核心功能之一。在 <code>config/pid.cfg</code>文件中，你可以找到以下关键参数：</p><ul><li><code>Kp</code>：比例系数，控制转向的快速响应</li><li><code>Ki</code>：积分系数，用于消除稳态误差</li><li><code>Kd</code>：微分系数，用于抑制振荡</li></ul><p>调参小贴士：</p><ul><li>先调 <code>Kp</code>：增大 <code>Kp</code>直到系统开始震荡，然后减小到震荡消失</li><li>再调 <code>Kd</code>：增大 <code>Kd</code>以减小过冲，但不要太大以免引入高频噪声</li><li>最后调 <code>Ki</code>：缓慢增加 <code>Ki</code>以消除稳态误差，但要注意不要引起振荡</li></ul><p>此外，我们的PID控制系统不仅仅是一个简单的PID控制器，它包含了多个高级特性，使得小车能够更好地适应各种赛道条件。以下是对这些特性的详细介绍：</p><p>以下是一个完整的PID配置实例：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">巡线机器人PID配置文件</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本参数</span></span><br><span class="line">max_linear_speed=0.25   # 最大线速度 (m/s)</span><br><span class="line">max_angular_speed=1.0   # 最大角速度 (rad/s)</span><br><span class="line">Kp=0.005                # 比例增益</span><br><span class="line">Ki=0.000005             # 积分增益</span><br><span class="line">Kd=0.009                # 微分增益</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">高级参数</span></span><br><span class="line">deadzone=30             # 死区 (像素)</span><br><span class="line">integral_limit=0.06     # 积分限幅，防止积分饱和</span><br><span class="line">error_threshold=60      # 积分分离阈值，大误差时停止积分</span><br><span class="line">soft_limit_lower=-1.0   # 软限幅下限</span><br><span class="line">soft_limit_upper=1.0    # 软限幅上限</span><br><span class="line">filter_coefficient=0.7  # 输入滤波系数，用于平滑输入信号</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其他参数</span></span><br><span class="line">pid_debug_output=false  # 控制是否打印调试信息</span><br><span class="line">end_audio_msg=/home/ucar/Desktop/ucar/src/main/navacation/voice_packge/任务完成/任务完成.wav # 结束之后播报的音频</span><br></pre></td></tr></table></figure><p>此外，我们的PID控制系统不仅仅是一个简单的PID控制器，它包含了多个高级特性，使得小车能够更好地适应各种赛道条件。以下是对这些特性的详细介绍：</p><h3 id="输入滤波">1. 输入滤波</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">double</span> filteredError = filter_coefficient_ * error + (<span class="number">1</span> - filter_coefficient_) * lastFilteredError;</span><br></pre></td></tr></table></figure><p><strong>作用</strong>：减少传感器噪声对控制系统的影响，使控制更加平滑。</p><p><strong>参数调整</strong>：</p><ul><li><code>filter_coefficient</code>：范围从0到1。值越大，滤波效果越弱；值越小，滤波效果越强。</li><li>建议从0.7开始，根据小车的反应进行微调。</li></ul><h3 id="死区控制">2. 死区控制</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">abs</span>(filteredError) &lt; deadzone_)</span><br><span class="line">&#123;</span><br><span class="line">    filteredError = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    filteredError = (filteredError &gt; <span class="number">0</span>) ? filteredError - deadzone_ : filteredError + deadzone_;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>作用</strong>：防止小误差引起的频繁抖动，提高系统稳定性。</p><p><strong>参数调整</strong>：</p><ul><li><code>deadzone</code>：根据你的赛道宽度和摄像头分辨率来设定。</li><li>从误差值的1-2%开始，逐步增加直到小车在直线上能保持稳定。</li></ul><h3 id="自适应pid参数">3. 自适应PID参数</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">adaptPIDParameters</span><span class="params">(<span class="type">double</span> error)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(error) &gt; error_threshold_ * <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        adaptive_Kp_ = Kp_ * <span class="number">1.5</span>;</span><br><span class="line">        adaptive_Ki_ = Ki_ * <span class="number">0.5</span>;</span><br><span class="line">        adaptive_Kd_ = Kd_ * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        adaptive_Kp_ = Kp_;</span><br><span class="line">        adaptive_Ki_ = Ki_;</span><br><span class="line">        adaptive_Kd_ = Kd_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>作用</strong>：根据误差大小动态调整PID参数，使得小车在不同情况下都能有最佳表现。</p><p><strong>参数调整</strong>：</p><ul><li><code>error_threshold</code>：决定何时启用自适应参数。建议设置为正常误差范围的2倍左右。</li><li>调整系数（如1.5，0.5，2）：根据小车在大弯道和直道上的表现来调整。</li></ul><h3 id="积分分离">4. 积分分离</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">abs</span>(filteredError) &lt; error_threshold_)</span><br><span class="line">&#123;</span><br><span class="line">    integral += filteredError;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    integral = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>作用</strong>：防止积分饱和，减少大幅度转向时的过冲现象。</p><p><strong>参数调整</strong>：</p><ul><li><code>error_threshold</code>：与自适应PID中的阈值可以保持一致。</li></ul><h3 id="积分限幅">5. 积分限幅</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">integral = <span class="built_in">max</span>(-integral_limit_, <span class="built_in">min</span>(integral_limit_, integral));</span><br></pre></td></tr></table></figure><p><strong>作用</strong>：进一步防止积分饱和，提高系统稳定性。</p><p><strong>参数调整</strong>：</p><ul><li><code>integral_limit_</code>：开始时可以设置为最大允许转向角的10-20%，然后根据小车表现进行调整。</li></ul><h3 id="微分先行">6. 微分先行</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> derivative = filteredError - lastError;</span><br></pre></td></tr></table></figure><p><strong>作用</strong>：提高系统响应速度，减少超调。</p><p><strong>参数调整</strong>：</p><ul><li>主要通过调整 <code>Kd_</code> 来控制微分作用的强度。</li></ul><h3 id="软限幅">7. 软限幅</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">steeringAngle = <span class="built_in">max</span>(soft_limit_lower_, <span class="built_in">min</span>(soft_limit_upper_, steeringAngle));</span><br></pre></td></tr></table></figure><p><strong>作用</strong>：防止输出饱和，使转向更加平滑。</p><p><strong>参数调整</strong>：</p><ul><li><code>soft_limit_lower</code> 和<code>soft_limit_upper</code>：根据你的舵机或电机的实际转向范围来设定。</li></ul><h3 id="参数调整总体建议">参数调整总体建议</h3><ol type="1"><li>从基础PID参数（<code>Kp_</code>, <code>Ki_</code>,<code>Kd_</code>）开始调整，使小车能基本循线。</li><li>逐步引入高级特性，每次只调整一个参数，观察小车表现。</li><li>使用调试输出(<code>pid_debug_output_</code>)来监控误差和输出值，帮助你更好地理解参数变化对系统的影响。</li><li>在不同类型的赛道上反复测试，找到一个能适应大多数情况的参数组合。</li><li>记录每次调整的结果，这将帮助你更快地找到最佳参数。</li></ol><h2 id="图像处理局限性">🖼️ 图像处理局限性</h2><p>请注意，当前的图像处理算法主要针对<strong>白线和蓝底的巡线方案</strong>进行了优化。如果你的赛道条件不同，可能需要修改<code>ImageProcessor</code> 类中的 <code>processImage</code> 函数。</p><p>特别是，你可能需要调整<code>config/pid.cfg</code>以下部分：</p><ul><li><strong>颜色阈值</strong>：调整 <code>line_threshold</code>值。这个部分较为死板，推荐使用 HSV 图像进行优化，然后自己添加参数。</li><li><strong>图像分割方法</strong>：如果你的赛道有不同的颜色或纹理，可能需要使用更复杂的图像分割算法。</li></ul><h3 id="配置示例">配置示例</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">line_threshold=220            # 提高阈值以检测更亮的线</span><br><span class="line">range_y=4                     # 增加垂直分割比例以检测更大的图像区域</span><br><span class="line">center_p=3                    # 扩展中心线参数以适应更宽的线条</span><br><span class="line">boundary_check_width=2        # 增加边界检测宽度以增强边界识别</span><br><span class="line">img_debug_output=false        # 禁用图像调试信息以提高性能</span><br><span class="line">image_topic=/new_camera/image # 更改图像话题名称以匹配新设备</span><br><span class="line">end_dist=7                    # 增加停止阈值以适应更长的赛道</span><br></pre></td></tr></table></figure><h3 id="适应其他场景的建议">适应其他场景的建议</h3><ul><li><strong>调整颜色阈值</strong>：根据赛道的实际颜色情况调整<code>line_threshold</code> 值，使用 HSV色彩空间可以更灵活地处理不同的颜色。</li><li><strong>改进图像分割</strong>：尝试使用不同的图像分割技术，如区域生长、边缘检测或深度学习方法，以适应不同的赛道条件。</li><li><strong>增强边界检测</strong>：调整<code>boundary_check_width</code>以增强边界检测的鲁棒性，特别是在复杂背景下。</li></ul><p>我们鼓励你发挥创意，尝试不同的图像处理技术，以适应你的特定应用场景。</p><h2 id="许可证">📜 许可证</h2><p>我们采用MIT许可证，这意味着你可以随意使用、修改、分发这个项目，但请保留我们的版权信息哦！</p><h2 id="致谢">🙏 致谢</h2><ul><li>感谢科大讯飞智能车比赛给了我们这个大显身手的机会</li><li>感谢ROS和OpenCV社区，没有你们，我们的小车就是个瞎子</li><li>感谢所有为开源社区做出贡献的开发者们，你们的智慧和奉献让技术变得更加开放和共享。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 开源项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ROS </tag>
            
            <tag> 双线巡线 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Q群机器人基本使用教程</title>
      <link href="/2023/09/30/ROBOT/Q%E7%BE%A4%E4%BA%91%E5%B4%BD%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
      <url>/2023/09/30/ROBOT/Q%E7%BE%A4%E4%BA%91%E5%B4%BD%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="q群机器人基本使用教程">Q群机器人基本使用教程</h1><p>这个教程就是针对于本人根据<strong>云崽框架</strong>搭建的QQ机器人的相关使用教程，教程如下</p><h2 id="一机器人基本介绍">一、机器人基本介绍</h2><p>机器人在Q群里面的名称叫做纳西妲（因为群主是纳西妲单推人），QQ号是1461277498，里面的很多功能在群聊也可以用，私聊一样可以。所以可以加机器人QQ，使用我用Chatgpt-plugin插件内置的gpt功能，也可以在群里面@机器人然后发你想询问的信息就可以。</p><p><strong>机器人内置插件如下图</strong>：</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272302413.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272302413.png"alt="image-20230727230210188" /></a></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272302677.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272302677.png"alt="image-20230727230220582" /></a></p><p>很多的插件都有相应的功能，<strong>一般的插件都会有对应功能的帮助面板</strong>，当然里面也只有一些常用的插件。</p><h2 id="二插件帮助面板">二、插件帮助面板</h2><p>对机器人发送对应的像（#{name}帮助）的<strong>指令</strong>就可以唤起对应的帮助面板，比如我机器人默认的就是喵喵插件的帮助，就可以发送<code>#帮助</code>或者<code>#喵喵帮助</code>得到对应的功能面板，如下图展示</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272305660.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272305660.png"alt="image-20230727230549577" /></a></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272305036.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272305036.png"alt="image-20230727230557952" /></a></p><p>这里面{name}就是填写对应插件的名字，然后发送成功后就可以得到对应的帮助面板，本群常用的有<strong>喵喵插件、星铁插件、土块插件、枫叶插件等等</strong>。如果你要唤起星铁插件的帮助面板就发<code>#星铁帮助</code>，如果你要土块插件的帮助面板就发<code>#土块帮助</code>其他的同理。还有就是本群很多的插件功能面板图都在群精华信息内。</p><h2id="三如何使用插件帮助面板图的功能">三、如何使用插件帮助面板图的功能</h2><p>以喵喵帮助面板的功能为例子</p><p>喵喵插件有很多栏的功能，我们先来看第三栏</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272316673.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272316673.png"alt="image-20230727231608460" /></a></p><p>上面的这些功能只要按照上面的提示输入就可以让机器人回复对应功能得到的结果，比如第一个<code>#体力</code>，就只需要对机器人，或者在群聊哪里发出对应的指令即可，比如看以下的操作</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272325460.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272325460.png"alt="image-20230727232506346" /></a></p><p>这个就是查询体力的服务，但是一般一开始没有这个功能，这个功能需要<strong>绑定cookie</strong>，这个的话在四再细说怎么绑定。帮助面板上面有很多功能都可以根据相关提示去使用，有兴趣的话可以都试着私聊机器人或者在群聊里面进行发送。</p><p>另外在介绍下ai绘图的帮助，ai绘图帮助的话是基于土块插件帮助的一个功能帮助，需要对机器人发送<code>#画图帮助</code>就可以得到对应的帮助面板</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272328204.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272328204.png"alt="image-20230727232822135" /></a></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272328750.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272328750.png"alt="image-20230727232843609" /></a></p><p>可以看到上面有很多的功能，同样的以第一个功能来举例，我们如果要使用ai#绘图的话可以对机器人发送<code>#绘个图 &#123;对应的图片描述tag&#125;</code>，比如我想要画个泳装的纳西妲的话，里面的关键词是纳西妲，泳装。此时我就要对机器人发送<code>#绘个图 纳西妲，泳装</code>，得到的结果如下所示</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272331438.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272331438.png"alt="image-20230727233120337" /></a></p><p>此时就得到了符合条件的ai作画！</p><h2id="四关于cookie以及token的绑定stoken也可以用于星铁cookie的绑定">四、关于cookie以及token的绑定（stoken也可以用于星铁cookie的绑定）</h2><h3id="方法一最简单很推荐但最好多设备扫码登录法">1、方法一（最简单，很推荐，但最好多设备）：#扫码登录法</h3><p>此方法需要在一台设备上面对机器人发送<code>#扫码登录</code>，然后用另外一台设备进入米游社去扫码，其实一个设备也行，不过你要保存机器人发送给你的二维码然后再去米游社扫码，操作如下</p><p><strong>1、对机器人发送#扫码登录</strong></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272336616.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272336616.png"alt="image-20230727233603554" /></a></p><p><strong>2、登录米游社进行扫码，尽量要快不然机器人会撤回！</strong></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272337098.jpg"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272337098.jpg"alt="Screenshot_2023-07-27-23-36-20-213_com.mihoyo.hyp" /></a></p><p><strong>3、扫码之后并且得到下面的结果即绑定stoken和cookie全部成功！</strong></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272349944.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272349944.png"alt="image-20230727234929884" /></a></p><h3id="方法二有点复杂不太推荐token绑定法">2、方法二（有点复杂，不太推荐）：token绑定法</h3><p><strong>1、下载群文件里面的软件</strong></p><p>群文件这个文件夹里面的软件</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272340216.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272340216.png"alt="image-20230727234022163" /></a></p><p><strong>2、打开该软件，并且登录账户</strong><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272342268.jpg"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272342268.jpg"alt="Screenshot_2023-07-27-23-41-14-001_com.miui.home-" /></a></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272343208.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272343208.png"alt="image-20230727234310153" /></a></p><p><strong>3、点击右上角三点进行获取token并全选复制</strong></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272344671.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272344671.png"alt="image-20230727234402619" /></a></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280017637.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280017637.png"alt="image-20230728001748561" /></a></p><p><strong>4、私聊发送给机器人</strong></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280018127.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280018127.png"alt="img" /></a></p><p><strong>5、按照给的提示功能面板发送#刷新ck，抽卡记录就是#更新抽卡记录（对应的查询就是，限定池#角色记录，武器池#武器记录，常驻池#常驻记录）</strong></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272347421.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272347421.png"alt="image-20230727234715364" /></a></p><p>显示上图就说明绑定完成啦！此时喵喵面板大部分功能全部都可以进行使用了！</p><h2 id="五一些相关补充">五、一些相关补充</h2><p>这里总结的介绍下机器人的大部分插件名字，方便可以发出正确的插件面板帮助指令</p><table><thead><tr><th>插件名字</th><th>帮助指令</th></tr></thead><tbody><tr><td>喵喵插件</td><td>#喵喵帮助（#帮助）</td></tr><tr><td>土块插件</td><td>#土块帮助</td></tr><tr><td>图鉴插件</td><td>#图鉴帮助</td></tr><tr><td>枫叶插件</td><td>#枫叶帮助</td></tr><tr><td>星铁插件</td><td>#星铁帮助</td></tr><tr><td>chatgpt插件</td><td>#chatgpt帮助</td></tr><tr><td>闲心插件</td><td>#闲心帮助</td></tr><tr><td>椰奶插件</td><td>#椰奶帮助</td></tr></tbody></table><p>这些就是对应大部分插件的的帮助指令了，通过输入对应的指令就可以得到对应的功能帮助面板服务，下面还要介绍一个很常用的功能就是原神面板服务了！</p><h2 id="原神面板服务">1、原神面板服务</h2><p>原神的面板服务是基于喵喵插件的一个功能，可以再功能图就可以看到对应的一些指令。</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272357860.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307272357860.png"alt="image-20230727235755745" /></a></p><p>首先要想使用这个插件里面的面板服务的话，首先需要确认你游戏里面的资料板上面的你想要看的角色是否公开了面板，如下操作所所示</p><p><strong>1、确认游戏内已经公开你想要查询的角色面板</strong></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280000677.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280000677.png"alt="image-20230728000035486" /></a></p><p><strong>右下角的显示角色详细一定要打开</strong>，展示的话就是你想要查询角色的面板。</p><p><strong>2、向机器人绑定你的游戏uid</strong></p><p>在前面绑定cookie的帮助局域栏的右边有个#绑定uid{你的uid}这个功能，就是对应激活这个功能的指令，比如我的游戏uid是110776530，那么操作如下</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280003331.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280003331.png"alt="image-20230728000303269" /></a></p><p><strong>3、发送#更新面板来进行获取</strong></p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280003437.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280003437.png"alt="image-20230728000348342" /></a></p><p>可以看到角色名字左边有个绿色圈圈就代表此角色面板已经更新，不过要<strong>注意这个面板更新的话如果此时刚刚好刚给角色换了圣遗物需要查看新圣遗物下角色的提升和分数就需要隔个5分钟左右更新，不然数据是不会更新的，更新成功的判断条件就是角色左边有个<code>小绿圈圈</code></strong></p><p><strong>4、发送#{角色名}面板来查询对应角色面板</strong></p><p>比如我要查纳西妲的面板就发送#纳西妲面板</p><p><ahref="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280007949.png"><imgsrc="https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202307280007949.png"alt="image-20230728000756873" /></a></p>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 教程 </tag>
            
            <tag> 云崽 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
